<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Web Scraping in R – SDS 264: Data Science 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SDS 264: Data Science 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tech-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tech Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tech-notes">    
        <li>
    <a class="dropdown-item" href="./tech_setup.html">
 <span class="dropdown-text">Tech Setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./why_quarto.html">
 <span class="dropdown-text">Why Quarto?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./github_intro.html">
 <span class="dropdown-text">Intro to GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./github_links.html">
 <span class="dropdown-text">GitHub Links</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="./01_review164.html">
 <span class="dropdown-text">Review of Data Science 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_maps.html">
 <span class="dropdown-text">Creating informative maps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_functions.html">
 <span class="dropdown-text">Functions and tidy evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04_code_quality.html">
 <span class="dropdown-text">Code quality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05_iteration.html">
 <span class="dropdown-text">Iteration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06_data_types.html">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07_apis.html">
 <span class="dropdown-text">Data Acquisition with APIs in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08_table_scraping.html">
 <span class="dropdown-text">Table Scraping in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09_web_scraping.html">
 <span class="dropdown-text">Web Scraping in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10_strings_part1.html">
 <span class="dropdown-text">Strings: Pre-class Video (Part 1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11_strings_part2.html">
 <span class="dropdown-text">Strings: In-class Exercises (Part 2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12_strings_part3.html">
 <span class="dropdown-text">Strings: Extra Practice (Part 3)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13_text_analysis.html">
 <span class="dropdown-text">Text analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./14_first_shiny_instructions.html">
 <span class="dropdown-text">First Shiny instructions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16_SQL_exercises.html">
 <span class="dropdown-text">SQL: Exercises</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./miniproject1.html">
 <span class="dropdown-text">Mini-Project 1: Maps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject2.html">
 <span class="dropdown-text">Mini-Project 2: Data Acquisition</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject3.html">
 <span class="dropdown-text">Mini-Project 3: Building a Personal Quarto Webpage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject4.html">
 <span class="dropdown-text">Mini-Project 4: Text Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./finalproject.html">
 <span class="dropdown-text">Final Project: Interactive Data Storytelling</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./rtipoftheday.html"> 
<span class="menu-text">R Tip of the Day</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09_web_scraping.html">Web Scraping in R</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_review164.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review of Data Science 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating informative maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions and tidy evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_code_quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code quality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Iteration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_data_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Acquisition with APIs in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_table_scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table Scraping in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_web_scraping.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Web Scraping in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_strings_part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: Pre-class Video (Part 1)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_strings_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: In-class Exercises (Part 2)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_strings_part3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: Extra Practice (Part 3)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_text_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_first_shiny_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First Shiny instructions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_SQL_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL: Exercises</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#using-rvest-for-web-scraping" id="toc-using-rvest-for-web-scraping" class="nav-link active" data-scroll-target="#using-rvest-for-web-scraping">Using rvest for web scraping</a>
  <ul class="collapse">
  <li><a href="#recall-the-four-steps-to-scraping-data-with-functions-in-the-rvest-library" id="toc-recall-the-four-steps-to-scraping-data-with-functions-in-the-rvest-library" class="nav-link" data-scroll-target="#recall-the-four-steps-to-scraping-data-with-functions-in-the-rvest-library">Recall the four steps to scraping data with functions in the <code>rvest</code> library:</a></li>
  <li><a href="#more-scraping-ethics" id="toc-more-scraping-ethics" class="nav-link" data-scroll-target="#more-scraping-ethics">More scraping ethics</a>
  <ul class="collapse">
  <li><a href="#robots.txt" id="toc-robots.txt" class="nav-link" data-scroll-target="#robots.txt"><code>robots.txt</code></a></li>
  <li><a href="#robotstxt-package" id="toc-robotstxt-package" class="nav-link" data-scroll-target="#robotstxt-package">robotstxt package</a></li>
  </ul></li>
  <li><a href="#a-timeout-to-preview-some-technical-ideas" id="toc-a-timeout-to-preview-some-technical-ideas" class="nav-link" data-scroll-target="#a-timeout-to-preview-some-technical-ideas">A timeout to preview some technical ideas</a>
  <ul class="collapse">
  <li><a href="#html-structure" id="toc-html-structure" class="nav-link" data-scroll-target="#html-structure">HTML structure</a></li>
  <li><a href="#finding-css-selectors" id="toc-finding-css-selectors" class="nav-link" data-scroll-target="#finding-css-selectors">Finding CSS Selectors</a></li>
  <li><a href="#selectorgadget" id="toc-selectorgadget" class="nav-link" data-scroll-target="#selectorgadget">SelectorGadget</a></li>
  </ul></li>
  <li><a href="#case-study-nih-news-releases" id="toc-case-study-nih-news-releases" class="nav-link" data-scroll-target="#case-study-nih-news-releases">Case Study: NIH News Releases</a>
  <ul class="collapse">
  <li><a href="#retrieving-data-using-rvest-and-css-selectors" id="toc-retrieving-data-using-rvest-and-css-selectors" class="nav-link" data-scroll-target="#retrieving-data-using-rvest-and-css-selectors">Retrieving Data Using <code>rvest</code> and CSS Selectors</a></li>
  <li><a href="#putting-multiple-columns-of-data-together." id="toc-putting-multiple-columns-of-data-together." class="nav-link" data-scroll-target="#putting-multiple-columns-of-data-together.">Putting multiple columns of data together.</a></li>
  </ul></li>
  <li><a href="#on-your-own" id="toc-on-your-own" class="nav-link" data-scroll-target="#on-your-own">On Your Own</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Web Scraping in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>You can download this .qmd file from <a href="https://github.com/proback/264_fall_2024/blob/main/09_web_scraping.qmd">here</a>. Just hit the Download Raw File button.</p>
<p>Credit to Brianna Heggeseth and Leslie Myint from Macalester College for a few of these descriptions and examples.</p>
<section id="using-rvest-for-web-scraping" class="level1">
<h1>Using rvest for web scraping</h1>
<p>Please see <code>08_table_scraping.qmd</code> for a preview of web scraping techniques when no API exists, along with ethical considerations when scraping data. In this file, we will turn to scenarios when the webpage contains data of interest, but it is not already in table form.</p>
<section id="recall-the-four-steps-to-scraping-data-with-functions-in-the-rvest-library" class="level2">
<h2 class="anchored" data-anchor-id="recall-the-four-steps-to-scraping-data-with-functions-in-the-rvest-library">Recall the four steps to scraping data with functions in the <code>rvest</code> library:</h2>
<ol start="0" type="1">
<li><code>robotstxt::paths_allowed()</code> Check if the website allows scraping, and then make sure we scrape “politely”</li>
<li><code>read_html()</code>. Input the URL containing the data and turn the html code into an XML file (another markup format that’s easier to work with).</li>
<li><code>html_nodes()</code>. Extract specific nodes from the XML file by using the CSS path that leads to the content of interest. (use css=“table” for tables.)</li>
<li><code>html_text()</code>. Extract content of interest from nodes. Might also use <code>html_table()</code> etc.</li>
</ol>
</section>
<section id="more-scraping-ethics" class="level2">
<h2 class="anchored" data-anchor-id="more-scraping-ethics">More scraping ethics</h2>
<section id="robots.txt" class="level3">
<h3 class="anchored" data-anchor-id="robots.txt"><code>robots.txt</code></h3>
<p><code>robots.txt</code> is a file that some websites will publish to clarify what can and cannot be scraped and other constraints about scraping. When a website publishes this file, this we need to comply with the information in it for moral and legal reasons.</p>
<p>We will look through the information in <a href="https://www.zenrows.com/blog/robots-txt-web-scraping">this tutorial</a> and apply this to the <a href="https://www.nih.gov/robots.txt">NIH robots.txt file</a>.</p>
<p>From our investigation of the NIH <code>robots.txt</code>, we learn:</p>
<ul>
<li><code>User-agent: *</code>: Anyone is allowed to scrape</li>
<li><code>Crawl-delay: 2</code>: Need to wait 2 seconds between each page scraped</li>
<li>No <code>Visit-time</code> entry: no restrictions on time of day that scraping is allowed</li>
<li>No <code>Request-rate</code> entry: no restrictions on simultaneous requests</li>
<li>No mention of <code>?page=</code>, <code>news-events</code>, <code>news-releases</code>, or <code>https://science.education.nih.gov/</code> in the <code>Disallow</code> sections. (This is what we want to scrape today.)</li>
</ul>
</section>
<section id="robotstxt-package" class="level3">
<h3 class="anchored" data-anchor-id="robotstxt-package">robotstxt package</h3>
<p>We can also use functions from the <a href="https://cran.r-project.org/web/packages/robotstxt/"><code>robotstxt</code> package</a>, which was built to download and parse robots.txt files (<a href="https://cran.r-project.org/web/packages/robotstxt/vignettes/using_robotstxt.html">more info</a>). Specifically, the <code>paths_allowed()</code> function can check if a bot has permission to access certain pages.</p>
</section>
</section>
<section id="a-timeout-to-preview-some-technical-ideas" class="level2">
<h2 class="anchored" data-anchor-id="a-timeout-to-preview-some-technical-ideas">A timeout to preview some technical ideas</h2>
<section id="html-structure" class="level3">
<h3 class="anchored" data-anchor-id="html-structure">HTML structure</h3>
<p>HTML (hypertext markup language) is the formatting language used to create webpages. We can see the core parts of HTML from the <a href="https://cran.r-project.org/web/packages/rvest/vignettes/rvest.html">rvest vignette</a>.</p>
</section>
<section id="finding-css-selectors" class="level3">
<h3 class="anchored" data-anchor-id="finding-css-selectors">Finding CSS Selectors</h3>
<p>In order to gather information from a webpage, we must learn the language used to identify patterns of specific information. For example, on the <a href="https://www.nih.gov/news-events/news-releases">NIH News Releases page</a>, we can see that the data is represented in a consistent pattern of image + title + abstract.</p>
<p>We will identify data in a web page using a pattern matching language called <a href="https://css-tricks.com/how-css-selectors-work/">CSS Selectors</a> that can refer to specific patterns in HTML, the language used to write web pages.</p>
<p>For example:</p>
<ul>
<li>Selecting by tag:
<ul>
<li><code>"a"</code> selects all hyperlinks in a webpage (“a” represents “anchor” links in HTML)</li>
<li><code>"p"</code> selects all paragraph elements</li>
</ul></li>
<li>Selecting by ID and class:
<ul>
<li><code>".description"</code> selects all elements with <code>class</code> equal to “description”
<ul>
<li>The <code>.</code> at the beginning is what signifies <code>class</code> selection.</li>
<li>This is one of the most common CSS selectors for scraping because in HTML, the <code>class</code> attribute is extremely commonly used to format webpage elements. (Any number of HTML elements can have the same <code>class</code>, which is not true for the <code>id</code> attribute.)</li>
</ul></li>
<li><code>"#mainTitle"</code> selects the SINGLE element with <strong>id</strong> equal to “mainTitle”
<ul>
<li>The <code>#</code> at the beginning is what signifies <code>id</code> selection.</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"title"</span><span class="dt">&gt;</span>Title of resource 1<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"description"</span><span class="dt">&gt;</span>Description of resource 1<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"title"</span><span class="dt">&gt;</span>Title of resource 2<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"description"</span><span class="dt">&gt;</span>Description of resource 2<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Warning</strong>: Websites change often! So if you are going to scrape a lot of data, it is probably worthwhile to save and date a copy of the website. Otherwise, you may return after some time and your scraping code will include all of the wrong CSS selectors.</p>
</section>
<section id="selectorgadget" class="level3">
<h3 class="anchored" data-anchor-id="selectorgadget">SelectorGadget</h3>
<p>Although you can <a href="[CSS Selectors](https://css-tricks.com/how-css-selectors-work/)">learn how to use CSS Selectors by hand</a>, we will use a shortcut by installing the <a href="http://selectorgadget.com/">Selector Gadget</a> tool.</p>
<ul>
<li>There is a version available for Chrome–add it to Chrome via the <a href="https://chromewebstore.google.com/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb">Chome Web Store</a>.
<ul>
<li>Make sure to pin the extension to the menu bar. (Click the 3 dots &gt; Extensions &gt; Manage extensions. Click the “Details” button under SelectorGadget and toggle the “Pin to toolbar” option.)</li>
</ul></li>
<li>There is also a version that can be saved as a bookmark in the browser–see <a href="https://rvest.tidyverse.org/articles/selectorgadget.html">here</a>.</li>
</ul>
<p>You might watch the Selector Gadget <a href="http://selectorgadget.com/">tutorial video</a>.</p>
</section>
</section>
<section id="case-study-nih-news-releases" class="level2">
<h2 class="anchored" data-anchor-id="case-study-nih-news-releases">Case Study: NIH News Releases</h2>
<p>Our goal is to build a data frame with the article title, publication date, and abstract text for the 50 most recent NIH news releases.</p>
<p>Head over to the <a href="https://www.nih.gov/news-events/news-releases">NIH News Releases page</a>. Click the Selector Gadget extension icon or bookmark button. As you mouse over the webpage, different parts will be highlighted in orange. Click on the title (but not the live link portion!) of the first news release. You’ll notice that the Selector Gadget information in the lower right describes what you clicked on. (If SelectorGadget ever highlights too much in green, you can click on portions that you do not want to turn them red.)</p>
<p>Scroll through the page to verify that only the information you intend (the description paragraph) is selected. The selector panel shows the CSS selector (<code>.teaser-title</code>) and the number of matches for that CSS selector (10). (You may have to be careful with your clicking–there are two overlapping boxes, and clicking on the link of the title can lead to the CSS selector of “a”.)</p>
<p><strong>[Pause to Ponder:]</strong> Repeat the process above to find the correct selectors for the following fields. Make sure that each matches 10 results:</p>
<ul>
<li>The publication date</li>
</ul>
<blockquote class="blockquote">
<p>.date-display-single</p>
</blockquote>
<ul>
<li>The article abstract paragraph (which will also include the publication date)</li>
</ul>
<blockquote class="blockquote">
<p>.teaser-description</p>
</blockquote>
<section id="retrieving-data-using-rvest-and-css-selectors" class="level3">
<h3 class="anchored" data-anchor-id="retrieving-data-using-rvest-and-css-selectors">Retrieving Data Using <code>rvest</code> and CSS Selectors</h3>
<p>Now that we have identified CSS selectors for the information we need, let’s fetch the data using the <code>rvest</code> package similarly to our approach in <code>08_table_scraping.qmd</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check that scraping is allowed (Step 0)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.nih.gov                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Download the HTML and turn it into an XML file with read_html()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nih <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finding the exact node (e.g.&nbsp;“.teaser-title”) is the tricky part. Among all the html code used to produce a webpage, where do you go to grab the content of interest? This is where SelectorGadget comes to the rescue!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Extract specific nodes with html_nodes()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>title_temp <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(nih, <span class="st">".teaser-title"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>title_temp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (10)}
 [1] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/nih-funded- ...
 [2] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/single-dose ...
 [3] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/nih-study-f ...
 [4] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/influenza-v ...
 [5] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/therapy-hel ...
 [6] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/excess-weig ...
 [7] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/nih-lead-im ...
 [8] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/contact-len ...
 [9] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/nih-funded- ...
[10] &lt;h4 class="teaser-title"&gt;&lt;a href="/news-events/news-releases/nih-researc ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Extract content from nodes with html_text(), html_name(), </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    html_attrs(), html_children(), html_table(), etc.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Usually will still need to do some stringr adjustments</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>title_vec <span class="ot">&lt;-</span> <span class="fu">html_text</span>(title_temp)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>title_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "NIH-funded clinical trial will evaluate new dengue therapeutic"                              
 [2] "Single dose of broadly neutralizing antibody protects macaques from H5N1 influenza"          
 [3] "NIH study finds infection-related hospitalizations linked to increased risk of heart failure"
 [4] "Influenza A viruses adapt shape in response to environmental pressures"                      
 [5] "Therapy helps peanut-allergic kids tolerate tablespoons of peanut butter"                    
 [6] "Excess weight gain in first trimester associated with fetal fat accumulation"                
 [7] "NIH to lead implementation of National Plan to End Parkinson’s Act"                          
 [8] "Contact lenses used to slow nearsightedness in youth have a lasting effect"                  
 [9] "NIH-funded study finds cases of ME/CFS increase following SARS-CoV-2"                        
[10] "NIH researchers discover novel class of anti-malaria antibodies"                             </code></pre>
</div>
</div>
<p>You can also write this altogether with a pipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.nih.gov                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".teaser-title"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "NIH-funded clinical trial will evaluate new dengue therapeutic"                              
 [2] "Single dose of broadly neutralizing antibody protects macaques from H5N1 influenza"          
 [3] "NIH study finds infection-related hospitalizations linked to increased risk of heart failure"
 [4] "Influenza A viruses adapt shape in response to environmental pressures"                      
 [5] "Therapy helps peanut-allergic kids tolerate tablespoons of peanut butter"                    
 [6] "Excess weight gain in first trimester associated with fetal fat accumulation"                
 [7] "NIH to lead implementation of National Plan to End Parkinson’s Act"                          
 [8] "Contact lenses used to slow nearsightedness in youth have a lasting effect"                  
 [9] "NIH-funded study finds cases of ME/CFS increase following SARS-CoV-2"                        
[10] "NIH researchers discover novel class of anti-malaria antibodies"                             </code></pre>
</div>
</div>
<p>And finally we wrap the 4 steps above into the <code>bow</code> and <code>scrape</code> functions from the <code>polite</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>session <span class="ot">&lt;-</span> <span class="fu">bow</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>, <span class="at">force =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>nih_title <span class="ot">&lt;-</span> <span class="fu">scrape</span>(session) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".teaser-title"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>nih_title</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "NIH-funded clinical trial will evaluate new dengue therapeutic"                              
 [2] "Single dose of broadly neutralizing antibody protects macaques from H5N1 influenza"          
 [3] "NIH study finds infection-related hospitalizations linked to increased risk of heart failure"
 [4] "Influenza A viruses adapt shape in response to environmental pressures"                      
 [5] "Therapy helps peanut-allergic kids tolerate tablespoons of peanut butter"                    
 [6] "Excess weight gain in first trimester associated with fetal fat accumulation"                
 [7] "NIH to lead implementation of National Plan to End Parkinson’s Act"                          
 [8] "Contact lenses used to slow nearsightedness in youth have a lasting effect"                  
 [9] "NIH-funded study finds cases of ME/CFS increase following SARS-CoV-2"                        
[10] "NIH researchers discover novel class of anti-malaria antibodies"                             </code></pre>
</div>
</div>
</section>
<section id="putting-multiple-columns-of-data-together." class="level3">
<h3 class="anchored" data-anchor-id="putting-multiple-columns-of-data-together.">Putting multiple columns of data together.</h3>
<p>Now repeat the process above to extract the publication date and the abstract.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nih_pubdate <span class="ot">&lt;-</span> <span class="fu">scrape</span>(session) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".date-display-single"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>nih_pubdate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "February 11, 2025" "February 11, 2025" "February 11, 2025"
 [4] "February 10, 2025" "February 10, 2025" "January 17, 2025" 
 [7] "January 17, 2025"  "January 16, 2025"  "January 13, 2025" 
[10] "January 3, 2025"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nih_description <span class="ot">&lt;-</span> <span class="fu">scrape</span>(session) <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".teaser-description"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>nih_description</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "February 11, 2025 —     \n          Dengue virus sickens as many as 400 million people each year, primarily in tropical and subtropical parts of the world. "
 [2] "February 11, 2025 —     \n          NIH science lays groundwork for future studies in people. "                                                              
 [3] "February 11, 2025 —     \n          Findings highlight the importance of infection prevention measures and personalized heart failure care. "                
 [4] "February 10, 2025 —     \n          NIH study identifies previously unknown adaptation. "                                                                    
 [5] "February 10, 2025 —     \n          NIH trial informs potential treatment strategy for kids who already tolerate half a peanut or more. "                    
 [6] "January 17, 2025 —     \n          Findings from NIH study suggest early intervention may prevent adult obesity associated with heavier birthweight. "       
 [7] "January 17, 2025 —     \n          Open call for participants to serve on Parkinson’s Advisory Council. "                                                    
 [8] "January 16, 2025 —     \n          NIH-funded study finds progression of eye growth returns to normal in older teens, with no loss of treatment benefit. "   
 [9] "January 13, 2025 —     \n          ME/CFS is a complex, serious, and chronic condition that often occurs following an infection. "                           
[10] "January 3, 2025 —     \n          New antibodies could lead to next generation of interventions against malaria. "                                           </code></pre>
</div>
</div>
<p>Combine these extracted variables into a single tibble. Make sure the variables are formatted correctly - e.g.&nbsp;<code>pubdate</code> has <code>date</code> type, <code>description</code> does not contain the <code>pubdate</code>, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use tibble() to put multiple columns together into a tibble</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>nih_top10 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">title =</span> nih_title, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pubdate =</span> nih_pubdate, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">description =</span> nih_description)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>nih_top10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   title                                                     pubdate description
   &lt;chr&gt;                                                     &lt;chr&gt;   &lt;chr&gt;      
 1 NIH-funded clinical trial will evaluate new dengue thera… Februa… "February …
 2 Single dose of broadly neutralizing antibody protects ma… Februa… "February …
 3 NIH study finds infection-related hospitalizations linke… Februa… "February …
 4 Influenza A viruses adapt shape in response to environme… Februa… "February …
 5 Therapy helps peanut-allergic kids tolerate tablespoons … Februa… "February …
 6 Excess weight gain in first trimester associated with fe… Januar… "January 1…
 7 NIH to lead implementation of National Plan to End Parki… Januar… "January 1…
 8 Contact lenses used to slow nearsightedness in youth hav… Januar… "January 1…
 9 NIH-funded study finds cases of ME/CFS increase followin… Januar… "January 1…
10 NIH researchers discover novel class of anti-malaria ant… Januar… "January 3…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now clean the data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>nih_top10 <span class="ot">&lt;-</span> nih_top10 <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pubdate =</span> <span class="fu">mdy</span>(pubdate),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">description =</span> <span class="fu">str_trim</span>(<span class="fu">str_replace</span>(description, <span class="st">".*</span><span class="sc">\\</span><span class="st">n"</span>, <span class="st">""</span>)))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>nih_top10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   title                                                  pubdate    description
   &lt;chr&gt;                                                  &lt;date&gt;     &lt;chr&gt;      
 1 NIH-funded clinical trial will evaluate new dengue th… 2025-02-11 Dengue vir…
 2 Single dose of broadly neutralizing antibody protects… 2025-02-11 NIH scienc…
 3 NIH study finds infection-related hospitalizations li… 2025-02-11 Findings h…
 4 Influenza A viruses adapt shape in response to enviro… 2025-02-10 NIH study …
 5 Therapy helps peanut-allergic kids tolerate tablespoo… 2025-02-10 NIH trial …
 6 Excess weight gain in first trimester associated with… 2025-01-17 Findings f…
 7 NIH to lead implementation of National Plan to End Pa… 2025-01-17 Open call …
 8 Contact lenses used to slow nearsightedness in youth … 2025-01-16 NIH-funded…
 9 NIH-funded study finds cases of ME/CFS increase follo… 2025-01-13 ME/CFS is …
10 NIH researchers discover novel class of anti-malaria … 2025-01-03 New antibo…</code></pre>
</div>
</div>
<p>NOW - continue this process to build a tibble with the most recent 50 NIH news releases, which will require that you iterate over 5 webpages! You should write at least one function, and you will need iteration–use both a <code>for</code> loop and appropriate <code>map_()</code> functions from <code>purrr</code>. Some additional hints:</p>
<ul>
<li>Mouse over the page buttons at the very bottom of the news home page to see what the URLs look like.</li>
<li>Include <code>Sys.sleep(2)</code> in your function to respect the <code>Crawl-delay: 2</code> in the NIH <code>robots.txt</code> file.</li>
<li>Recall that <code>bind_rows()</code> from <code>dplyr</code> takes a list of data frames and stacks them on top of each other.</li>
</ul>
<p><strong>[Pause to Ponder:]</strong> Create a function to scrape a single NIH press release page by filling missing pieces labeled <code>???</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to reduce html_nodes() |&gt; html_text() code duplication</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>get_text_from_page <span class="ot">&lt;-</span> <span class="cf">function</span>(page, css_selector) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  ???</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Main function to scrape and tidy desired attributes</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>scrape_page <span class="ot">&lt;-</span> <span class="cf">function</span>(url) {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    article_titles <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(???)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    article_dates <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(???)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    article_dates <span class="ot">&lt;-</span> <span class="fu">mdy</span>(article_dates)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    article_description <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(???)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    article_description <span class="ot">&lt;-</span> <span class="fu">str_trim</span>(<span class="fu">str_replace</span>(article_description, </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">".*</span><span class="sc">\\</span><span class="st">n"</span>, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">""</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      ???</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>[Pause to Ponder:]</strong> Use a for loop over the first 5 pages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pages <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">5</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(???)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  pages[[i <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> ???</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>df_articles <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_articles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>[Pause to Ponder:]</strong> Use map functions in the purrr package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a character vector of URLs for the first 5 pages</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"???"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>urls_all_pages <span class="ot">&lt;-</span> <span class="fu">c</span>(base_url, <span class="fu">str_c</span>(???))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>pages2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(???)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>df_articles2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages2)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_articles2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="on-your-own" class="level2">
<h2 class="anchored" data-anchor-id="on-your-own">On Your Own</h2>
<ol type="1">
<li>Go to https://www.bestplaces.net and search for Minneapolis, Minnesota. This is a site some people use when comparing cities they might consider working in and/or moving to. Using SelectorGadget, extract the following pieces of information from the Minneapolis page:</li>
</ol>
<ul>
<li>property crime (on a scale from 0 to 100)</li>
<li>minimum income required for a single person to live comfortably</li>
<li>average monthly rent for a 2-bedroom apartment</li>
<li>the “about” paragraph (the very first paragraph above “Location Details”)</li>
</ul>
<ol start="2" type="1">
<li><p>Write a function called <code>scrape_bestplaces()</code> with arguments for <code>state</code> and <code>city</code>. When you run, for example, <code>scrape_bestplaces("minnesota", "minneapolis")</code>, the output should be a 1 x 6 tibble with columns for <code>state</code>, <code>city</code>, <code>crime</code>, <code>min_income_single</code>, <code>rent_2br</code>, and <code>about</code>.</p></li>
<li><p>Create a 5 x 6 tibble by running <code>scrape_bestplaces()</code> 5 times with 5 cities you are interested in. You might have to combine tibbles using <code>bind_rows()</code>. Be sure you look at the URL at bestplaces.net for the various cities to make sure it works as you expect. For bonus points, create the same 5 x 6 tibble for the same 5 cities using <code>purrr:map2</code>!</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Paul Roback, 2024<br> All content licensed under <img src="https://static.thenounproject.com/png/70967-200.png" height="20"> (<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Site built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>